<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ageflix - Home</title>
  <style>
    * { box-sizing: border-box; margin:0; padding:0; font-family: Arial, sans-serif; }
    body { background: #000; color:#fff; }

    /* Navbar */
    nav.navbar {
      display: flex;
      align-items: center;
      justify-content: space-between;
      background-color: #111;
      color: #fff;
      padding: 10px 20px;
      flex-wrap: wrap;
    }
    .navbar .logo { font-size: 24px; font-weight: bold; flex: 1; color: #e50914; }
    .navbar ul { display: flex; list-style: none; justify-content: center; flex:2; }
    .navbar ul li { margin: 0 15px; }
    .navbar ul li a { color:#fff; text-decoration: none; font-weight: bold; }
    .navbar .icon { flex: 1; text-align: right; }

    /* Marquee */
    .marquee-container {
      width: 100%;
      overflow: hidden;
      background: #222;
      color: #fff;
      font-size: 20px;
      padding: 10px 0;
    }
    .marquee {
      display: inline-block;
      white-space: nowrap;
      animation: marquee 15s linear infinite;
    }
    @keyframes marquee {
      0% { transform: translateX(100%); }
      100% { transform: translateX(-100%); }
    }

    /* Banner */
    .banner-slider { position: relative; overflow: hidden; max-width: 100%; height: 400px; margin-bottom:20px; background:#000; }
    .slide { position: absolute; width: 100%; height: 100%; opacity: 0; transition: opacity 1s ease-in-out; }
    .slide.active { opacity: 1; z-index: 2; }
    .slide img { width: 100%; height: 100%; object-fit: cover; }
    .prev, .next { position: absolute; top: 50%; transform: translateY(-50%); background-color: rgba(0,0,0,0.5); color: #fff; border: none; padding: 10px; cursor: pointer; font-size: 24px; z-index: 3; }
    .prev { left: 10px; }
    .next { right: 10px; }
    .dots { position: absolute; bottom: 10px; left: 50%; transform: translateX(-50%); display: flex; gap: 8px; z-index: 3; }
    .dot { width: 12px; height: 12px; border-radius: 50%; background-color: rgba(255,255,255,0.5); cursor: pointer; }
    .dot.active { background-color: #fff; }

    /* Hero */
    section.hero { text-align: center; padding: 40px 20px; }
    section.hero h1 { font-size: 32px; margin-bottom: 10px; color:#fff; }
    section.hero p { font-size: 18px; margin-bottom: 20px; color:#ccc; }
    button#startBtn { padding: 12px 25px; font-size: 18px; cursor: pointer; background:#e50914; color:#fff; border:none; border-radius:4px; transition:0.3s; }
    button#startBtn:hover { background:#b00610; }

    #webcam-container, #label-container { margin: 15px auto; }
    #loading {
      display:none;
      margin-top:20px;
      font-size:20px;
      color:#e50914;
      animation: blink 1s infinite;
    }
    @keyframes blink { 50%{opacity:0.5;} }

    @media(max-width:768px){
      section.hero h1 { font-size: 24px; }
      button#startBtn { font-size: 16px; }
      .marquee-container { font-size: 16px; }
    }
  </style>
</head>
<body>

  <nav class="navbar">
    <div class="logo">Ageflix</div>
    <ul>
      <li><a href="about.html">About</a></li>
      <li><a href="movies.html">Movies</a></li>
      <li><a href="contact.html">Contact</a></li>
    </ul>
    <div class="icon">ðŸŽ¬</div>
  </nav>

  <div class="marquee-container">
    <div class="marquee" id="marqueeText"></div>
  </div>

  <section class="banner-slider" id="bannerSlider">
    <div class="slide active"><img src="1.jpeg" alt="Banner 1"></div>
    <div class="slide"><img src="2.jpeg" alt="Banner 2"></div>
    <button class="prev">&#10094;</button>
    <button class="next">&#10095;</button>
    <div class="dots"></div>
  </section>

  <section class="hero">
    <h1>Welcome to Ageflix</h1>
    <p>Discover movies according to your age group!</p>

    <div id="webcam-container"></div>
    <div id="label-container"></div>
    <div id="loading">Loading your movies...</div>

    <button id="startBtn">Start Camera & Detect Age</button>
  </section>

  <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@3.21.0/dist/tf.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@teachablemachine/image@0.8.4/dist/teachablemachine-image.min.js"></script>

  <script>
    const URL = "https://teachablemachine.withgoogle.com/models/UujRQ_OS4/";
    let model, webcam, maxPredictions, detected = false;

    async function init() {
      document.getElementById("startBtn").style.display = "none";
      document.getElementById("label-container").innerText = "Initializing camera...";

      const modelURL = URL + "model.json";
      const metadataURL = URL + "metadata.json";

      model = await tmImage.load(modelURL, metadataURL);
      maxPredictions = model.getTotalClasses();

      const flip = true;
      webcam = new tmImage.Webcam(400, 300, flip);

      try {
        await webcam.setup(); // ÙŠØ·Ù„Ø¨ Ø§Ù„Ø¥Ø°Ù† Ù…Ù† Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
        await webcam.play();
        document.getElementById("webcam-container").appendChild(webcam.canvas);
        document.getElementById("label-container").innerText = "Detecting...";
        window.requestAnimationFrame(loop);
      } catch (err) {
        alert("Please allow camera access to continue.");
        document.getElementById("startBtn").style.display = "block";
      }
    }

    async function loop() {
      webcam.update();
      await predict();
      if (!detected) window.requestAnimationFrame(loop);
    }

    async function predict() {
      const prediction = await model.predict(webcam.canvas);
      const best = prediction.reduce((a, b) => a.probability > b.probability ? a : b);
      const label = best.className;
      const confidence = best.probability;

      const labelContainer = document.getElementById("label-container");
      labelContainer.innerHTML = `You are: <span style="color:#e50914;font-weight:bold;">${label}</span>`;

      if (confidence > 0.90 && !detected) {
        detected = true;
        showLoading(label);
      }
    }

    function showLoading(label) {
      document.getElementById("loading").style.display = "block";
      document.getElementById("label-container").innerHTML = "";

      setTimeout(() => {
        if (label.toLowerCase() === "kids" || label.toLowerCase() === "kid") {
          window.location.href = "kids.html";
        } else if (label.toLowerCase() === "adult") {
          window.location.href = "adult.html";
        } else if (label.toLowerCase() === "senior") {
          window.location.href = "senior.html";
        } else {
          alert("Age group not recognized, please try again.");
          location.reload();
        }
      }, 2500);
    }

    document.getElementById("startBtn").addEventListener("click", init);

    // Slider
    const slides = document.querySelectorAll('.slide');
    const prev = document.querySelector('.prev');
    const next = document.querySelector('.next');
    const dotsContainer = document.querySelector('.dots');
    let slideIndex = 0;

    function showSlide(index){
      if(index < 0) slideIndex = slides.length-1;
      else if(index >= slides.length) slideIndex = 0;
      else slideIndex = index;

      slides.forEach((s,i)=>{
        s.classList.remove('active');
        if(dotsContainer.children[i]) dotsContainer.children[i].classList.remove('active');
      });
      slides[slideIndex].classList.add('active');
      if(dotsContainer.children[slideIndex]) dotsContainer.children[slideIndex].classList.add('active');
    }

    prev.addEventListener('click', ()=> showSlide(slideIndex-1));
    next.addEventListener('click', ()=> showSlide(slideIndex+1));

    slides.forEach((_,i)=>{
      const dot = document.createElement('span');
      dot.classList.add('dot');
      if(i===0) dot.classList.add('active');
      dot.addEventListener('click', ()=>showSlide(i));
      dotsContainer.appendChild(dot);
    });

    // Marquee
    const marqueeTextElem = document.getElementById('marqueeText');
    const marqueeMessages = [
      "Ageflix recommends movies based on your age",
      "Find the perfect movie for kids, adults, and seniors",
      "Your personalized movie guide!",
      "Discover films suitable for your age",
      "Enjoy movies safely with Ageflix"
    ];
    let marqueeIndex = 0;
    function updateMarquee(){
      marqueeTextElem.innerText = marqueeMessages[marqueeIndex];
      marqueeIndex = (marqueeIndex+1) % marqueeMessages.length;
    }
    setInterval(updateMarquee, 5000);
    updateMarquee();
  </script>
</body>
</html>
