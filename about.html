<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>AgeFlix</title>

  <!-- ŸÖŸÉÿ™ÿ®ÿ© Teachable Machine -->
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@3.3.0/dist/tf.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@teachablemachine/image@0.8/dist/teachablemachine-image.min.js"></script>

  <style>
    body {
      margin: 0;
      background-color: #000;
      color: white;
      font-family: "Netflix Sans", Arial, sans-serif;
      overflow-x: hidden;
      text-align: center;
    }

    header {
      background-color: #111;
      padding: 20px;
      font-size: 32px;
      font-weight: bold;
      color: #e50914;
      letter-spacing: 2px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.6);
    }

    #webcam-container {
      margin-top: 40px;
    }

    #startBtn {
      background-color: #e50914;
      color: white;
      border: none;
      padding: 15px 40px;
      border-radius: 5px;
      font-size: 18px;
      cursor: pointer;
      transition: 0.3s;
    }

    #startBtn:hover {
      background-color: #b00610;
    }

    #label-container {
      margin-top: 20px;
      color: #ccc;
    }

    footer {
      margin-top: 80px;
      padding: 20px;
      color: #666;
      font-size: 14px;
    }

    /* üéûÔ∏è ÿ≥ŸÑÿßŸäÿØÿ± */
    .slider {
      position: relative;
      max-width: 800px;
      margin: 60px auto;
      overflow: hidden;
      border-radius: 10px;
      box-shadow: 0 0 20px rgba(255,255,255,0.1);
    }

    .slide {
      display: none;
      width: 100%;
    }

    .slide.active {
      display: block;
      animation: fade 1s ease;
    }

    @keyframes fade {
      from {opacity: 0.5;}
      to {opacity: 1;}
    }

    .slide img {
      width: 100%;
      border-radius: 10px;
    }

    .prev, .next {
      cursor: pointer;
      position: absolute;
      top: 50%;
      width: auto;
      padding: 10px;
      margin-top: -22px;
      color: white;
      font-weight: bold;
      font-size: 24px;
      border-radius: 0 3px 3px 0;
      user-select: none;
      background: rgba(0,0,0,0.4);
    }

    .next { right: 0; }

    .prev:hover, .next:hover {
      background: rgba(0,0,0,0.8);
    }

    .dots {
      text-align: center;
      margin-top: 10px;
    }

    .dot {
      height: 10px;
      width: 10px;
      margin: 0 3px;
      background-color: #bbb;
      border-radius: 50%;
      display: inline-block;
      cursor: pointer;
    }

    .dot.active {
      background-color: #e50914;
    }

    /* ÿßŸÑŸÜÿµ ÿßŸÑŸÖÿ™ÿ≠ÿ±ŸÉ */
    .marquee {
      margin-top: 30px;
      color: #fff;
      font-size: 20px;
      overflow: hidden;
      white-space: nowrap;
      text-align: center;
      text-shadow: 0 0 10px rgba(255,255,255,0.2);
    }
  </style>
</head>

<body>
  <header>AGEFLIX</header>

  <div id="webcam-container"></div>
  <div id="label-container"></div>
  <button id="startBtn">üé• Start Camera & Detect Age</button>

  <div class="slider">
    <div class="slide active"><img src="https://i.ibb.co/nj2Tt4v/movie1.jpg" alt="Slide 1"></div>
    <div class="slide"><img src="https://i.ibb.co/F0c2tYV/movie2.jpg" alt="Slide 2"></div>
    <div class="slide"><img src="https://i.ibb.co/X7jJvZs/movie3.jpg" alt="Slide 3"></div>
    <a class="prev">&#10094;</a>
    <a class="next">&#10095;</a>
  </div>

  <div class="dots"></div>
  <div class="marquee"><span id="marqueeText"></span></div>

  <footer>¬© 2025 AgeFlix. All Rights Reserved.</footer>

  <!-- üé¨ ÿ≥ŸÉÿ±ÿ®ÿ™ ÿßŸÑŸÖŸàŸÇÿπ -->
  <script>
    const URL = "https://teachablemachine.withgoogle.com/models/UujRQ_OS4/";
    let model, webcam, maxPredictions;
    let detected = false;

    async function init() {
      const modelURL = URL + "model.json";
      const metadataURL = URL + "metadata.json";
      model = await tmImage.load(modelURL, metadataURL);
      maxPredictions = model.getTotalClasses();

      const flip = true;
      webcam = new tmImage.Webcam(400, 300, flip);
      await webcam.setup();
      await webcam.play();
      document.getElementById("webcam-container").appendChild(webcam.canvas);
      window.requestAnimationFrame(loop);
    }

    async function loop() {
      webcam.update();
      await predict();
      if (!detected) window.requestAnimationFrame(loop);
    }

    async function predict() {
      const prediction = await model.predict(webcam.canvas);
      let labelContainer = document.getElementById("label-container");
      labelContainer.innerHTML = "";
      prediction.forEach(p => {
        labelContainer.innerHTML += `<p>${p.className}: ${(p.probability * 100).toFixed(2)}%</p>`;
      });

      const best = prediction.reduce((a, b) => a.probability > b.probability ? a : b);

      if (best.probability > 0.85 && !detected) {
        detected = true;
        showPopup(best.className);
      }
    }

    function showPopup(userGroup) {
      const popup = document.createElement("div");
      popup.id = "popup";
      popup.innerHTML = `
        <div class="popup-content">
          <h2>You are <span>${userGroup}</span></h2>
          <button id="nextBtn">Next ‚ûú</button>
        </div>
      `;
      document.body.appendChild(popup);

      document.getElementById("nextBtn").addEventListener("click", () => {
        popup.remove();
        showLoading(userGroup);
      });
    }

    function showLoading(userGroup) {
      const loadingScreen = document.createElement("div");
      loadingScreen.id = "loading-screen";
      loadingScreen.innerHTML = `
        <div class="loader"></div>
        <p class="loading-text">Loading your movies...</p>
      `;
      document.body.appendChild(loadingScreen);

      setTimeout(() => {
        loadingScreen.remove();
        if (userGroup.toLowerCase() === "kids" || userGroup.toLowerCase() === "kid") {
          window.location.href = "kids.html";
        } else if (userGroup.toLowerCase() === "adult") {
          window.location.href = "adult.html";
        } else if (userGroup.toLowerCase() === "senior") {
          window.location.href = "senior.html";
        } else {
          alert("Could not detect age group. Please try again.");
          location.reload();
        }
      }, 3000);
    }

    document.getElementById("startBtn").addEventListener("click", init);

    const style = document.createElement("style");
    style.innerHTML = `
      @keyframes spin { 0% { transform: rotate(0deg);} 100% { transform: rotate(360deg);} }

      #popup {
        position: fixed; top: 0; left: 0;
        width: 100%; height: 100%;
        background: rgba(0,0,0,0.8);
        display: flex; justify-content: center; align-items: center;
        z-index: 9999;
      }

      .popup-content {
        background: #111;
        border: 2px solid #e50914;
        padding: 30px 50px;
        border-radius: 10px;
        text-align: center;
        color: white;
        box-shadow: 0 0 20px rgba(229,9,20,0.6);
        animation: fadeIn 0.5s ease;
      }

      .popup-content h2 { font-size: 28px; margin-bottom: 20px; }
      .popup-content span { color: #e50914; font-weight: bold; }

      #nextBtn {
        background-color: #e50914; color: white; border: none;
        padding: 12px 40px; border-radius: 5px; font-size: 18px;
        cursor: pointer; transition: 0.3s;
      }
      #nextBtn:hover { background-color: #b00610; }

      #loading-screen {
        position: fixed; top: 0; left: 0;
        width: 100%; height: 100%;
        background-color: #000;
        display: flex; flex-direction: column;
        justify-content: center; align-items: center;
        color: white; z-index: 99999;
      }

      .loader {
        border: 6px solid #f3f3f3;
        border-top: 6px solid #e50914;
        border-radius: 50%;
        width: 70px; height: 70px;
        animation: spin 1s linear infinite;
        margin-bottom: 25px;
      }

      .loading-text {
        font-size: 20px;
        letter-spacing: 1px;
        color: #fff;
        text-shadow: 0 0 10px rgba(255,255,255,0.4);
        animation: pulse 1.5s ease-in-out infinite;
      }

      @keyframes pulse { 0%, 100% { opacity: 0.7; } 50% { opacity: 1; } }
      @keyframes fadeIn { from { opacity: 0; transform: scale(0.9);} to { opacity: 1; transform: scale(1);} }
    `;
    document.head.appendChild(style);

    // üé¨ ÿ≥ŸÑÿßŸäÿØÿ± Ÿà ÿßŸÑŸÜÿµŸàÿµ
    const slides = document.querySelectorAll('.slide');
    const prev = document.querySelector('.prev');
    const next = document.querySelector('.next');
    const dotsContainer = document.querySelector('.dots');
    let slideIndex = 0;

    function showSlide(index){
      if(index < 0) slideIndex = slides.length-1;
      else if(index >= slides.length) slideIndex = 0;
      else slideIndex = index;

      slides.forEach((s,i)=>{
        s.classList.remove('active');
        if(dotsContainer.children[i]) dotsContainer.children[i].classList.remove('active');
      });
      slides[slideIndex].classList.add('active');
      if(dotsContainer.children[slideIndex]) dotsContainer.children[slideIndex].classList.add('active');
    }

    prev.addEventListener('click', ()=> showSlide(slideIndex-1));
    next.addEventListener('click', ()=> showSlide(slideIndex+1));

    slides.forEach((_,i)=>{
      const dot = document.createElement('span');
      dot.classList.add('dot');
      if(i===0) dot.classList.add('active');
      dot.addEventListener('click', ()=>showSlide(i));
      dotsContainer.appendChild(dot);
    });

    const marqueeTextElem = document.getElementById('marqueeText');
    const marqueeMessages = [
      "Ageflix recommends movies based on your age",
      "Find the perfect movie for kids, adults, and seniors",
      "Your personalized movie guide!",
      "Discover films suitable for your age",
      "Enjoy movies safely with Ageflix"
    ];
    let marqueeIndex = 0;
    function updateMarquee(){
      marqueeTextElem.innerText = marqueeMessages[marqueeIndex];
      marqueeIndex = (marqueeIndex+1) % marqueeMessages.length;
    }
    setInterval(updateMarquee, 5000);
    updateMarquee();
  </script>
</body>
</html>
