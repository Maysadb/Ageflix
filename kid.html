<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Face Analysis Demo</title>
<style>
body { font-family: Arial, sans-serif; margin:0; padding:0; }
header { background:#222; color:#fff; padding:10px 20px; display:flex; align-items:center; justify-content:space-between; }
header .logo { font-size:24px; font-weight:bold; }
header nav a { color:#fff; margin-left:20px; text-decoration:none; }
.slider { display:flex; overflow:hidden; width:100%; max-height:300px; }
.slider img { width:100%; animation: slide 6s infinite; }
@keyframes slide {
  0%,50% { transform: translateX(0); }
  50%,100% { transform: translateX(-100%); }
}
.popup { position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.8); display:flex; justify-content:center; align-items:center; z-index:9999; }
.popup-content { background:#fff; padding:20px; border-radius:8px; text-align:center; width:450px; max-width:90%; }
#video-container video { width:100%; border-radius:8px; }
#label-container p { margin:5px 0; font-size:16px; font-weight:bold; }
#countdown-bar { width:100%; height:20px; background:#ccc; margin:10px 0; border-radius:10px; overflow:hidden; }
#countdown-fill { height:100%; width:0%; background:#4caf50; transition:width 1s linear; }
button { padding:10px 20px; font-size:16px; margin-top:10px; cursor:pointer; }
</style>
<script src="https://cdn.jsdelivr.net/npm/@teachablemachine/image@0.8/dist/teachablemachine-image.min.js"></script>
</head>
<body>

<header>
  <div class="logo">My Logo</div>
  <nav>
    <a href="#">Home</a>
    <a href="#">About</a>
    <a href="#">Contact</a>
  </nav>
</header>

<div class="slider">
  <img src="1.jpg" alt="Slide 1">
  <img src="2.jpg" alt="Slide 2">
</div>

<script>
const URL = "YOUR_TEACHABLE_MACHINE_URL_HERE/"; // ضع رابط النموذج هنا
let webcam, model, maxPredictions;

async function init() {
    // تحميل النموذج
    model = await tmImage.load(URL + "model.json", URL + "metadata.json");
    maxPredictions = model.getTotalClasses();

    // إعداد الكاميرا
    webcam = new tmImage.Webcam(400, 300, true);
    await webcam.setup();
    await webcam.play();

    // إنشاء البوب
    const popup = document.createElement("div");
    popup.className = "popup";
    popup.id = "popup";
    popup.innerHTML = `
      <div class="popup-content">
        <h2>Analyzing your face...</h2>
        <div id="video-container"></div>
        <div id="label-container"></div>
        <div id="countdown-bar"><div id="countdown-fill"></div></div>
      </div>
    `;
    document.body.appendChild(popup);
    document.getElementById("video-container").appendChild(webcam.video);

    startCountdown();
    requestAnimationFrame(loop);
}

async function loop() {
    webcam.update();
    const prediction = await model.predict(webcam.canvas);
    const labelContainer = document.getElementById("label-container");
    labelContainer.innerHTML = "";
    prediction.forEach(p => {
        labelContainer.innerHTML += `<p>${p.className}: ${(p.probability*100).toFixed(1)}%</p>`;
    });
    requestAnimationFrame(loop);
}

// العد التنازلي 20 ثانية
function startCountdown() {
    let countdown = 20;
    const countdownFill = document.getElementById("countdown-fill");

    const interval = setInterval(() => {
        countdown--;
        countdownFill.style.width = ((20 - countdown) / 20 * 100) + "%";
        if (countdown <= 0) {
            clearInterval(interval);
            showResult();
        }
    }, 1000);
}

// عرض النتيجة
function showResult() {
    const popup = document.getElementById("popup");
    popup.querySelector(".popup-content").innerHTML = `
        <h2>Your Age Group is...</h2>
        <div id="label-container"></div>
        <button id="nextBtn">Next ➜</button>
    `;
    document.getElementById("nextBtn").addEventListener("click", () => {
        popup.querySelector(".popup-content").innerHTML = "<h2>Loading movies suitable for you...</h2>";
        setTimeout(() => {
            popup.remove();
            window.location.href = "movies.html"; // ضع رابط صفحة الأفلام هنا
        }, 3000);
    });
}

// بدء كل شيء عند تحميل الصفحة
window.addEventListener("load", init);
</script>

</body>
</html>
