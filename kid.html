<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ageflix</title>
<style>
  * {box-sizing:border-box;margin:0;padding:0;font-family: Arial, sans-serif;}
  body {background:#000;color:#fff;}
  .navbar {display:flex;justify-content:space-between;align-items:center;padding:10px 20px;background:#111;}
  .logo {color:red;font-size:24px;font-weight:bold;}
  .navbar ul {display:flex;list-style:none;}
  .navbar ul li {margin:0 15px;}
  .navbar ul li a {color:#fff;text-decoration:none;font-weight:bold;}
  .slider {position:relative;width:100%;max-width:800px;margin:20px auto;overflow:hidden;}
  .slide {width:100%;display:none;}
  .slide.active {display:block;}
  .slide img {width:100%;height:400px;object-fit:cover;}
  /* TM + popups */
  #webcam-container {text-align:center;margin:20px;}
  #label-container {margin-top:10px;font-size:18px;}
  #startBtn {padding:12px 25px;background:red;color:#fff;border:none;font-size:18px;cursor:pointer;border-radius:5px;margin-top:10px;}
  #popup, #loading-screen {position:fixed;top:0;left:0;width:100%;height:100%;display:flex;justify-content:center;align-items:center;background:rgba(0,0,0,0.85);z-index:9999;flex-direction:column;}
  .popup-content {background:#111;border:2px solid red;padding:30px 50px;border-radius:10px;text-align:center;}
  .popup-content h2 {font-size:28px;margin-bottom:20px;}
  #nextBtn {background:red;color:#fff;border:none;padding:12px 40px;border-radius:5px;font-size:18px;cursor:pointer;}
  .loader {border:6px solid #f3f3f3;border-top:6px solid red;border-radius:50%;width:70px;height:70px;animation:spin 1s linear infinite;margin-bottom:25px;}
  @keyframes spin{0%{transform:rotate(0deg);}100%{transform:rotate(360deg);}}
</style>
</head>
<body>

<!-- Navbar -->
<nav class="navbar">
  <div class="logo">Ageflix</div>
  <ul>
    <li><a href="#">About</a></li>
    <li><a href="#">Movies</a></li>
    <li><a href="#">Contact</a></li>
  </ul>
</nav>

<!-- Slider -->
<div class="slider">
  <div class="slide active"><img src="1.jpg" alt="1"></div>
  <div class="slide"><img src="2.jpg" alt="2"></div>
</div>

<!-- Teachable Machine -->
<div id="webcam-container">
  <video id="webcam" width="400" height="300" autoplay muted playsinline></video>
  <div id="label-container"></div>
  <button id="startBtn">Start Age Analysis</button>
</div>

<script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@3.21.0/dist/tf.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@teachablemachine/image@0.8.4/dist/teachablemachine-image.min.js"></script>
<script>
let model, webcam, maxPredictions;
const URL = "https://teachablemachine.withgoogle.com/models/UujRQ_OS4/";
let detected=false;

async function initTM(){
  const modelURL = URL+"model.json";
  const metadataURL = URL+"metadata.json";
  model = await tmImage.load(modelURL,metadataURL);
  maxPredictions = model.getTotalClasses();

  webcam = new tmImage.Webcam(400,300,true);
  await webcam.setup();
  await webcam.play();
  document.getElementById("webcam-container").appendChild(webcam.canvas);

  countdown(20); // 20 sec countdown
}

function countdown(seconds){
  const popup=document.createElement("div");
  popup.id="popup";
  popup.innerHTML=`
    <div class="popup-content">
      <h2>Analyzing your face...</h2>
      <p id="countdown-text">${seconds} seconds remaining</p>
      <div id="label-container"></div>
    </div>
  `;
  document.body.appendChild(popup);

  let interval=setInterval(async ()=>{
    document.getElementById("countdown-text").innerText = seconds+" seconds remaining";
    const prediction = await model.predict(webcam.canvas);
    const labelContainer = document.getElementById("label-container");
    labelContainer.innerHTML="";
    prediction.forEach(p=>{labelContainer.innerHTML+=`${p.className}: ${(p.probability*100).toFixed(1)}%<br>`});
    seconds--;
    if(seconds<0){
      clearInterval(interval);
      showResult(prediction);
    }
  },1000);
}

function showResult(prediction){
  const best=prediction.reduce((a,b)=>a.probability>b.probability?a:b);
  const popup=document.getElementById("popup");
  popup.innerHTML=`
    <div class="popup-content">
      <h2>Your age group is <span>${best.className}</span></h2>
      <button id="nextBtn">Next âžœ</button>
    </div>
  `;
  document.getElementById("nextBtn").addEventListener("click",()=>{
    popup.innerHTML=`<div class="popup-content"><div class="loader"></div><p>Loading your suitable movies...</p></div>`;
    setTimeout(()=>{
      if(best.className.toLowerCase().includes("kid")) window.location.href="kids.html";
      else if(best.className.toLowerCase().includes("adult")) window.location.href="adult.html";
      else if(best.className.toLowerCase().includes("senior")) window.location.href="senior.html";
    },3000);
  });
}

document.getElementById("startBtn").addEventListener("click",initTM);

// Slider logic
let slides=document.querySelectorAll(".slide");
let current=0;
setInterval(()=>{slides[current].classList.remove("active");current=(current+1)%slides.length;slides[current].classList.add("active");},5000);

</script>
</body>
</html>
