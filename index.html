<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ageflix - Home</title>
  <style>
    * { box-sizing: border-box; margin:0; padding:0; font-family: 'Helvetica Neue', Arial, sans-serif; }
    body { background: #000; color: #fff; }

    /* Navbar */
    nav.navbar {
      display: flex;
      align-items: center;
      justify-content: space-between;
      background-color: #111;
      padding: 10px 20px;
      flex-wrap: wrap;
    }
    .navbar .logo { font-size: 28px; font-weight: bold; color: #e50914; flex:1; }
    .navbar ul { display: flex; list-style: none; justify-content: center; flex:2; }
    .navbar ul li { margin: 0 15px; }
    .navbar ul li a { color:#fff; text-decoration: none; font-weight: bold; }
    .navbar .icon { flex:1; text-align: right; }

    /* Marquee */
    .marquee-container {
      width: 100%;
      overflow: hidden;
      background: #222;
      color: #fff;
      font-size: 22px;
      padding: 10px 0;
    }
    .marquee {
      display: inline-block;
      white-space: nowrap;
      animation: marquee 15s linear infinite;
    }
    @keyframes marquee {
      0% { transform: translateX(100%); }
      100% { transform: translateX(-100%); }
    }

    /* Hero */
    section.hero { text-align: center; padding: 30px 20px; }
    section.hero h1 { font-size: 36px; margin-bottom: 10px; }
    section.hero p { font-size: 20px; margin-bottom: 20px; }
    button#startBtn {
      padding: 12px 30px;
      font-size: 18px;
      cursor: pointer;
      background-color: #e50914;
      color: #fff;
      border: none;
      border-radius: 5px;
      transition: 0.3s;
    }
    button#startBtn:hover { background-color: #b00610; }

    #webcam-container, #label-container { margin: 20px auto; }

    /* Responsive */
    @media(max-width:768px){
      .navbar ul { flex: 1; justify-content: space-around; margin:10px 0; }
      section.hero h1 { font-size: 28px; }
      section.hero p { font-size: 16px; }
      button#startBtn { font-size: 16px; }
      .marquee-container { font-size: 18px; }
    }

    /* Popup */
    #popup-overlay {
      position:fixed;
      top:0; left:0; width:100%; height:100%;
      background: rgba(0,0,0,0.8);
      display:flex; justify-content:center; align-items:center;
      z-index: 9999;
    }
    #popup-overlay .popup-content{
      background:#141414;
      border:2px solid #e50914;
      padding:30px 50px;
      border-radius:10px;
      text-align:center;
      color:white;
      max-width:400px;
      box-shadow:0 0 20px rgba(229,9,20,0.6);
      animation: fadeIn 0.5s ease;
    }
    #popup-overlay .popup-content span{ color:#e50914; font-weight:bold; }
    #popup-overlay .popup-content button{
      margin-top:20px;
      padding:10px 25px;
      background:#e50914;
      border:none;
      color:#fff;
      border-radius:5px;
      cursor:pointer;
      transition:0.3s;
    }
    #popup-overlay .popup-content button:hover{ background:#b00610; }

    @keyframes fadeIn{ from{opacity:0; transform:scale(0.9);} to{opacity:1; transform:scale(1);} }
  </style>
</head>
<body>

  <!-- Navbar -->
  <nav class="navbar">
    <div class="logo">Ageflix</div>
    <ul>
      <li><a href="about.html">About</a></li>
      <li><a href="movies.html">Movies</a></li>
      <li><a href="contact.html">Contact</a></li>
    </ul>
    <div class="icon">ðŸŽ¬</div>
  </nav>

  <!-- Marquee -->
  <div class="marquee-container">
    <div class="marquee" id="marqueeText">Welcome to Ageflix!</div>
  </div>

  <!-- Hero -->
  <section class="hero">
    <h1>Welcome to Ageflix</h1>
    <p>Discover movies according to your age group!</p>

    <div id="webcam-container"></div>
    <div id="label-container"></div>

    <button id="startBtn">Start Camera & Detect Age</button>
  </section>

  <!-- Scripts -->
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@3.21.0/dist/tf.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@teachablemachine/image@0.8.4/dist/teachablemachine-image.min.js"></script>

  <script>
    const URL = "https://teachablemachine.withgoogle.com/models/UujRQ_OS4/";
    let model, webcam, maxPredictions;
    let detected = false;

    async function init() {
      const modelURL = URL + "model.json";
      const metadataURL = URL + "metadata.json";
      model = await tmImage.load(modelURL, metadataURL);
      maxPredictions = model.getTotalClasses();

      webcam = new tmImage.Webcam(400, 300, true);
      await webcam.setup();
      await webcam.play();
      document.getElementById("webcam-container").appendChild(webcam.canvas);
      window.requestAnimationFrame(loop);
    }

    async function loop() {
      webcam.update();
      await predict();
      if(!detected) window.requestAnimationFrame(loop);
    }

    async function predict() {
      const prediction = await model.predict(webcam.canvas);
      let labelContainer = document.getElementById("label-container");
      labelContainer.innerHTML = "";
      prediction.forEach(p => {
        labelContainer.innerHTML += `<p>${p.className}: ${(p.probability*100).toFixed(2)}%</p>`;
      });

      const best = prediction.reduce((a,b)=> a.probability>b.probability?a:b);
      if(best.probability>0.85 && !detected){
        detected = true;
        showPopup(best.className);
      }
    }

    function showPopup(userGroup){
      const overlay = document.createElement("div");
      overlay.id = "popup-overlay";
      overlay.innerHTML = `
        <div class="popup-content">
          <h2>You are <span>${userGroup}</span></h2>
          <p>We will redirect you to age-appropriate content!</p>
          <button id="popupClose">Close</button>
        </div>
      `;
      document.body.appendChild(overlay);

      document.getElementById("popupClose").addEventListener("click", () => {
        overlay.remove();
        // Redirect Ø¨Ø¹Ø¯ Ø§Ù„Ø¥ØºÙ„Ø§Ù‚
        if(userGroup.toLowerCase() === "kids" || userGroup.toLowerCase() === "kid") window.location.href="kids.html";
        else if(userGroup.toLowerCase() === "adult") window.location.href="adult.html";
        else if(userGroup.toLowerCase() === "senior") window.location.href="senior.html";
        else location.reload();
      });
    }

    document.getElementById("startBtn").addEventListener("click", init);

    // Marquee
    const marqueeTextElem = document.getElementById('marqueeText');
    const marqueeMessages = [
      "Ageflix recommends movies based on your age",
      "Find the perfect movie for kids, adults, and seniors",
      "Your personalized movie guide!",
      "Discover films suitable for your age",
      "Enjoy movies safely with Ageflix"
    ];
    let marqueeIndex = 0;
    function updateMarquee(){
      marqueeTextElem.innerText = marqueeMessages[marqueeIndex];
      marqueeIndex = (marqueeIndex + 1) % marqueeMessages.length;
    }
    setInterval(updateMarquee, 5000);
    updateMarquee();
  </script>

</body>
</html>
