<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ageflix - Home</title>
<link rel="stylesheet" href="style.css">
<script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs"></script>
<script src="https://cdn.jsdelivr.net/npm/@teachablemachine/image"></script>
</head>
<body>
<header>
  <div class="logo">Ageflix</div>
  <nav>
    <a href="index.html">Home</a>
    <a href="movies-kid.html">Kids</a>
    <a href="movies-adult.html">Adults</a>
    <a href="movies-senior.html">Seniors</a>
    <a href="about.html">About</a>
  </nav>
</header>

<main>
  <div class="hero">
    <h1>Welcome to Ageflix</h1>
    <p>Discover movies suitable for your age group!</p>
    <button id="startCamera" class="btn-red">ðŸŽ¥ Start Camera</button>
  </div>

  <div id="webcam-container" class="webcam-box"></div>
  <h2 id="ageResult" class="age-text"></h2>
</main>

<script>
const URL = "model/"; // Ù…Ø¬Ù„Ø¯ Ø§Ù„Ù…ÙˆØ¯ÙŠÙ„ Ø¹Ù„Ù‰ GitHub
let model, webcam;

// ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…ÙˆØ¯ÙŠÙ„ ÙˆØ§Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ù†Ø¬Ø§Ø­Ù‡
async function loadModel() {
  try {
    model = await tmImage.load(URL + "model.json", URL + "metadata.json");
    console.log("Model loaded successfully");
  } catch (error) {
    console.error("Failed to load the model:", error);
    alert("Error loading model. Check console and make sure model folder exists with correct files.");
  }
}

// Ø¨Ø¯Ø¡ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ ÙˆØ§Ù„ØªÙ†Ø¨Ø¤
async function init() {
  await loadModel();

  webcam = new tmImage.Webcam(320, 240, true);
  await webcam.setup();
  webcam.play();
  document.getElementById("webcam-container").appendChild(webcam.canvas);
  window.requestAnimationFrame(loop);
}

// Ø­Ù„Ù‚Ø© Ø§Ù„ØªÙ†Ø¨Ø¤ Ø§Ù„Ù…Ø³ØªÙ…Ø±
async function loop() {
  webcam.update();
  const prediction = await model.predict(webcam.canvas);
  const top = prediction.reduce((prev, curr) => prev.probability > curr.probability ? prev : curr);
  document.getElementById("ageResult").innerText = `Detected Age: ${top.className}`;
  window.requestAnimationFrame(loop);
}

document.getElementById("startCamera").addEventListener("click", () => {
  init();
});
</script>
</body>
</html>
